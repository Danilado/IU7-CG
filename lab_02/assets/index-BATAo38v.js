var F=Object.defineProperty;var O=(r,t,e)=>t in r?F(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>(O(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const N=1e-10,w=1;class l{constructor(t,e){o(this,"x");o(this,"y");this.x=t,this.y=e}toString(){return`(${_(this.x,1)}, ${_(this.y,1)})`}}function I(r,t){return Math.abs(r.x-t.x)<N&&Math.abs(r.y-t.y)<N}class H{constructor(t,e,i){o(this,"vertex1");o(this,"vertex2");o(this,"vertex3");this.vertex1=t,this.vertex2=e,this.vertex3=i}}class ${constructor(t){o(this,"vertexes");this.vertexes=t}}class D{constructor(t,e){o(this,"center");o(this,"r");this.center=t,this.r=e}}class W{constructor(t,e,i,s=0,n=0,a=Math.PI*2,h=!1){o(this,"center");o(this,"width");o(this,"height");o(this,"rotation");o(this,"startAngle");o(this,"endAngle");o(this,"cc");this.center=t,this.width=e,this.height=i,this.rotation=s,this.startAngle=n,this.endAngle=a,this.cc=h}}function G(r){return r*180/Math.PI}function y(r){return r/180*Math.PI}function _(r,t){return Math.round(r*Math.pow(10,t))/Math.pow(10,t)}let T=!1;const M=document.querySelector("#origin-x"),C=document.querySelector("#origin-y"),K=document.querySelector("#i-angle"),j=document.querySelector("#kx"),z=document.querySelector("#ky"),J=document.querySelector("#dx"),Q=document.querySelector("#dy"),U=document.querySelector("#add_rotation"),V=document.querySelector("#add_scale"),X=document.querySelector("#add_translation"),Y=document.querySelector("#clearout"),Z=document.querySelector(".footertext"),tt=document.querySelector("#themechange"),et=document.querySelector("#clearall"),L=document.querySelector(".transformations");tt.addEventListener("click",()=>{T=!T;let r=document.querySelectorAll("*");if(T)for(let t of r)t.classList.add("dark");else for(let t of r)t.classList.remove("dark")});class it{constructor(t){o(this,"node");this.node=t}write(t,e){this.node.innerHTML+=e+t.replace(/\n/,"<br />")+"<br />",this.scrollToBottom()}clear(){this.node.innerHTML=""}warn(t){}log(t){}error(t){this.write(t,"ERROR: ")}scrollToBottom(){this.node.scroll(0,this.node.scrollHeight)}}const g=new it(Z),k=document.querySelector("#staticPlane"),f=document.querySelector("#dynamicPlane");f.width=Math.round(f.getBoundingClientRect().width*w);f.height=Math.round(f.getBoundingClientRect().height*w);k.width=Math.round(f.getBoundingClientRect().width*w);k.height=Math.round(f.getBoundingClientRect().height*w);const st=f.getContext("2d"),rt=k.getContext("2d");class q{constructor(){o(this,"activated");o(this,"node",document.createElement("div"));o(this,"textfiled",document.createElement("div"));o(this,"remove_btn",document.createElement("input"));o(this,"activated_check",document.createElement("input"));this.activated=!0,this._buildNode()}getPoint(){return null}transformPoint(t){return t}_buildNode(){this.node.classList.add("row"),this._buildDelButton(),this._buildCheckBox(),this.textfiled.classList.add("tranformtext"),this.node.appendChild(this.textfiled),this.node.appendChild(this.activated_check),this.node.appendChild(this.remove_btn)}_buildDelButton(){this.remove_btn.type="button",this.remove_btn.value="⨯",this.remove_btn.classList.add("button")}_buildCheckBox(){this.activated_check.style.minWidth="4em",this.activated_check.type="button",this.activated_check.classList.add("button"),this.activated_check.value="ВКЛ",this.activated_check.addEventListener("click",()=>{this.activated=!this.activated,this.activated_check.value=this.activated?"ВКЛ":"ВЫКЛ"})}}class nt extends q{constructor(e,i){super();o(this,"pivot");o(this,"angle");this.pivot=e,this.angle=i,this.textfiled.innerHTML=`Вращение<br/>Угол: ${_(G(this.angle),3)}град.<br/>центр: ${this.pivot.toString()}`}apply(e){if(!this.activated)return;let i=e.getCanvasCoords(this.pivot);e.context.translate(i.x,i.y),e.context.rotate(this.angle),e.context.translate(-i.x,-i.y)}getPoint(){return this.pivot}transformPoint(e){return this.activated?new l((e.x-this.pivot.x)*Math.cos(this.angle)-(e.y-this.pivot.y)*Math.sin(this.angle)+this.pivot.x,(e.x-this.pivot.x)*Math.sin(this.angle)+(e.y-this.pivot.y)*Math.cos(this.angle)+this.pivot.y):e}}class at extends q{constructor(e,i){super();o(this,"origin");o(this,"scale");this.origin=e,this.scale=i,this.textfiled.innerHTML=`Масштабирование<br/>kx: ${this.scale.x} ky: ${this.scale.y}<br/>центр: ${this.origin.toString()}`}apply(e){if(!this.activated)return;let i=e.getCanvasCoords(this.origin);e.context.transform(this.scale.x,0,0,this.scale.y,i.x*(1-this.scale.x),i.y*(1-this.scale.y))}getPoint(){return this.origin}transformPoint(e){return this.activated?new l(e.x*this.scale.x+this.origin.x*(1-this.scale.x),e.y*this.scale.y+this.origin.y*(1-this.scale.y)):e}}class ot extends q{constructor(e){super();o(this,"translation");this.translation=e,this.textfiled.innerHTML=`Смещение<br/>dx: ${this.translation.x} dy: ${this.translation.y}`}apply(e){this.activated&&e.context.transform(1,0,0,1,this.translation.x*e.scale,this.translation.y*e.scale)}transformPoint(e){return this.activated?new l(e.x+this.translation.x,e.y+this.translation.y):e}}class R{constructor(t,e,i){o(this,"context");o(this,"context_node");o(this,"canvas_width");o(this,"canvas_height");o(this,"width");o(this,"height");o(this,"transformations",[]);o(this,"minx");o(this,"miny");o(this,"maxx");o(this,"maxy");o(this,"base");o(this,"aspect_ratio");o(this,"scale");this.canvas_width=f.width,this.canvas_height=f.height,this.context=t,this.context_node=e,this.width=this.canvas_width,this.height=this.canvas_height,this.minx=0,this.miny=0,this.maxx=this.width,this.maxy=this.height,this.base={x:0,y:-this.maxy},this.aspect_ratio=this.canvas_width/this.canvas_height,this.scale=1,this.context.textAlign="center",this.context.font=`${w*16}px serif`,this.context.lineWidth=3*w,i?(this.context.fillStyle=i,this.context.strokeStyle=i):this.context.fillStyle="#222222"}getCanvasCoords(t){return new l(this.base.x+(t.x-this.minx)*this.scale,-(this.base.y+(t.y-this.miny)*this.scale))}drawPoint(t,e,i=this.context,s,n){if(this.minx>t.x||this.maxx<t.x||this.miny>t.y||this.maxy<t.y)return null;let a=new l(t.x,t.y);for(let u of this.transformations)a=u.transformPoint(a);let h=this.getCanvasCoords(a);if(!h)return;i.beginPath(),this.context.save(),s&&(i.strokeStyle=s),s&&(i.fillStyle=s),e=e.replace(/<COORDS>/,a.toString()),i.arc(h.x,h.y,3,0,Math.PI*2),i.fill(),i.closePath();let c=0,d=-10;n&&(c=n.x,d=n.y),i.beginPath(),i.fillText(e,h.x+c*w,h.y+d*w),i.closePath(),this.context.restore()}drawCircleManually(t,e,i){let s=t.r,n=t.center.x,a=t.center.y,h;this.context.beginPath();for(let c=e;c<i;c+=1/s){let d=new l(n+s*Math.cos(c),a+s*Math.sin(c));for(let u of this.transformations)d=u.transformPoint(d);d=this.getCanvasCoords(d),h===void 0?(h=d,this.context.moveTo(h.x,h.y)):this.context.lineTo(d.x,d.y)}this.context.lineTo(h.x,h.y),this.context.stroke(),this.context.closePath()}drawTriangle(t,e=this.context,i){let s=new l(t.vertex1.x,t.vertex1.y),n=new l(t.vertex2.x,t.vertex2.y),a=new l(t.vertex3.x,t.vertex3.y);for(let c of this.transformations)s=c.transformPoint(s),n=c.transformPoint(n),a=c.transformPoint(a);s=this.getCanvasCoords(s),n=this.getCanvasCoords(n),a=this.getCanvasCoords(a),e.beginPath();let h=e.strokeStyle;i&&(e.strokeStyle=i),e.moveTo(s.x,s.y),e.lineTo(n.x,n.y),e.lineTo(a.x,a.y),e.lineTo(s.x,s.y),e.stroke(),e.strokeStyle=h,e.closePath()}drawPolygon(t,e=this.context,i){e.beginPath();let s=e.strokeStyle;i&&(e.strokeStyle=i);let n;for(let a=0;a<t.vertexes.length;++a){let h=new l(t.vertexes[a].x,t.vertexes[a].y);for(let c of this.transformations)h=c.transformPoint(h);h=this.getCanvasCoords(h),a==0?(n=h,this.context.moveTo(h.x,h.y)):this.context.lineTo(h.x,h.y)}e.lineTo(n.x,n.y),e.stroke(),e.strokeStyle=s,e.closePath()}drawSegment(t,e,i=this.context,s){let n=new l(t.x,t.y),a=new l(e.x,e.y);for(let c of this.transformations)n=c.transformPoint(n),a=c.transformPoint(a);n=this.getCanvasCoords(n),a=this.getCanvasCoords(a),i.beginPath();let h=i.strokeStyle;s&&(i.strokeStyle=s),i.moveTo(n.x,n.y),i.lineTo(a.x,a.y),i.stroke(),i.strokeStyle=h,i.closePath()}drawEllipseManually(t,e,i,s,n,a){this.context.beginPath();let h=Math.max(i,s),c;for(let d=n;d<a;d+=1/h){let u=new l(t+i*Math.cos(d),e+s*Math.sin(d));for(let p of this.transformations)u=p.transformPoint(u);u=this.getCanvasCoords(u),c===void 0?(c=u,this.context.moveTo(c.x,c.y)):this.context.lineTo(u.x,u.y)}this.context.lineTo(c.x,c.y),this.context.stroke(),this.context.closePath()}drawCanvas(t,e=0,i=0){this.context.drawImage(t,e,i)}endFrame(){this.context.clearRect(0,0,this.canvas_width,this.canvas_height)}setBoundaries(t){let e=t.x_min,i=t.x_max,s=t.y_min,n=t.y_max,a=i-e,h=n-s;if(a/h<this.aspect_ratio){let u=h/a*this.aspect_ratio,p=a*u-a;i+=p/2,e-=p/2,a=a*u}else{let u=a/h/this.aspect_ratio,p=h*u-h;n+=p/2,s-=p/2,h=h*u}let d=this.canvas_width/a;this.minx=e,this.maxx=i,this.miny=s,this.maxy=n,this.scale=d,this.width=a,this.height=h,g.log(`Меняю масштаб и пределы. Текущий масштаб: ${_(this.scale,2)} пикс. к 1 ед координат`),g.log(`x: [${_(e,2)}; ${_(i,2)}]   y: [${_(s,2)}; ${_(n,2)}]`)}}const m=200,E=Math.sqrt(m*m*3/4),x=new H(new l(-m/2,-E/3),new l(0,E*2/3),new l(m/2,-E/3)),P=new D(new l(0,0),m/2/Math.sqrt(3)),ht=new $([x.vertex2,x.vertex1,new l(x.vertex1.x-m*Math.cos(y(30)),x.vertex1.y+m*Math.sin(y(30))),new l(-m*Math.cos(y(30)),x.vertex2.y+m*Math.sin(y(30)))]),lt=new $([x.vertex2,x.vertex3,new l(x.vertex3.x+m*Math.cos(y(30)),x.vertex3.y+m*Math.sin(y(30))),new l(+m*Math.cos(y(30)),x.vertex2.y+m*Math.sin(y(30)))]),b=new W(new l(0,x.vertex1.y),m/2,P.r,0,Math.PI,Math.PI*2,!0);class ct{constructor(t,e){o(this,"transformations",[]);o(this,"fg_graphics");o(this,"bg_graphics");this.fg_graphics=t,this.bg_graphics=e}draw_bg(){this.draw_figure(this.bg_graphics);let t=[P.center];for(let e of this.transformations){let i=e.getPoint();i&&(t=t.filter(s=>!I(s,i)),t.push(i))}for(let e of t)this.bg_graphics.drawPoint(e,`(${e.x}, ${e.y})`,this.bg_graphics.context,"red")}draw_figure(t){t.drawPolygon(ht),t.drawPolygon(lt),t.drawCircleManually(P,0,Math.PI*2),t.drawEllipseManually(b.center.x,b.center.y,b.width,b.height,b.startAngle,b.endAngle),t.drawPoint(P.center,"<COORDS>",t.context,"#00FF00")}draw_fg(){this.fg_graphics.transformations=this.transformations,this.draw_figure(this.fg_graphics)}addTransformation(t){this.transformations.push(t),L.appendChild(t.node),t.remove_btn.addEventListener("click",()=>{L.removeChild(t.node),this.transformations=this.transformations.filter(e=>e!==t),this.update()}),t.activated_check.addEventListener("click",()=>{this.update()})}drawFocus(t){this.bg_graphics.endFrame(),this.draw_bg(),this.bg_graphics.drawPoint(t,"ЦТ",this.bg_graphics.context,"#FF0088",{x:0,y:20})}update(){this.fg_graphics.endFrame(),this.draw_fg(),S()}clearAll(){L.innerHTML="",this.transformations=[],this.update()}}U.addEventListener("click",()=>{let r,t,e;if(r=Number(M.value),t=Number(C.value),Number.isNaN(r)||Number.isNaN(t))return g.error("Ошибка считывания координат центра врщения");if(e=Number(K.value),Number.isNaN(e))return g.error("Ошибка считывания угла поворота");e=y(e),v.addTransformation(new nt(new l(r,t),e)),v.update()});Y.addEventListener("click",()=>{g.clear()});X.addEventListener("click",()=>{let r=Number(J.value),t=Number(Q.value);if(Number.isNaN(r)||Number.isNaN(t))return g.error("Ошибка считывания смещения");v.addTransformation(new ot(new l(r,t))),v.update()});function S(){let r=Number(M.value),t=Number(C.value);Number.isNaN(r)||Number.isNaN(t)||v.drawFocus(new l(r,t))}V.addEventListener("click",()=>{let r,t,e,i;if(r=Number(M.value),t=Number(C.value),Number.isNaN(r)||Number.isNaN(t))return g.error("Ошибка считывания координат центра масштабирования");if(e=Number(j.value),i=Number(z.value),Number.isNaN(e)||Number.isNaN(i))return g.error("Ошибка считывания коэффицентов масштабирования");if(Math.abs(e)<N||Math.abs(i)<N)return g.error("Ошибка: Попытка масштабирования с нулевым коэффицентом");v.addTransformation(new at(new l(r,t),{x:e,y:i})),v.update()});M.addEventListener("input",S);C.addEventListener("input",S);et.addEventListener("click",()=>{v.clearAll()});const A=new R(st,f,"black"),B=new R(rt,k,"#aaaaaa"),dt=[A,B];dt.forEach(r=>{r.endFrame(),r.setBoundaries({x_min:-800,x_max:800,y_min:-400,y_max:400})});const v=new ct(A,B);v.update();S();
